<!DOCTYPE html><html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>شبیه CodePen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.min.css" rel="stylesheet" />
  <style>
    body, html { margin:0; padding:0; height:100%; font-family:sans-serif; direction:rtl; }
    .topbar { height:50px; background:#252526; display:flex; align-items:center; justify-content:space-between; padding:0 15px; color:#eee; }
    .topbar select, .topbar button, .topbar input { margin:0 5px; padding:6px; border-radius:6px; border:none; background:#3A3D41; color:white; }
    .main { display:flex; flex-direction:column; height:calc(100% - 50px); }
    .editors { display:flex; height:50%; }
    .editor { flex:1; display:flex; flex-direction:column; }
    #editorHtml, #editorCss, #editorJs { flex:1; border-left:1px solid #444; }
    #editorHtml { border-left:none; }
    .preview { height:50%; background:#fff; }
    iframe { width:100%; height:100%; border:none; }
  </style>
</head>
<body>  <div class="topbar">
    <div>
      <button onclick="runAll()">▶ اجرا</button>
      <button onclick="saveCode()">💾 ذخیره</button>
      <button onclick="downloadVideo()">🎬 دانلود ویدیو</button>
      <input type="file" onchange="loadFile(event)">
    </div>
    <div>
      <select id="themeSel">
        <option value="vs-dark">تاریک</option>
        <option value="vs">روشن</option>
      </select>
      <select id="langMode">
        <option value="html">HTML/CSS/JS</option>
        <option value="javascript">JavaScript</option>
      </select>
    </div>
  </div>  <div class="main">
    <div class="editors">
      <div class="editor" id="editorHtml"></div>
      <div class="editor" id="editorCss"></div>
      <div class="editor" id="editorJs"></div>
    </div>
    <div class="preview">
      <iframe id="frame"></iframe>
    </div>
  </div>  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.js"></script>  <script>
    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
    require(['vs/editor/editor.main'], () => {
      window.htmlEditor = monaco.editor.create(document.getElementById('editorHtml'), {
        language: 'html', theme: 'vs-dark', automaticLayout:true, minimap:{enabled:false}
      });
      window.cssEditor = monaco.editor.create(document.getElementById('editorCss'), {
        language: 'css', theme: 'vs-dark', automaticLayout:true, minimap:{enabled:false}
      });
      window.jsEditor = monaco.editor.create(document.getElementById('editorJs'), {
        language: 'javascript', theme: 'vs-dark', automaticLayout:true, minimap:{enabled:false}
      });

      document.getElementById('themeSel').onchange = e => {
        monaco.editor.setTheme(e.target.value);
      };
      document.getElementById('langMode').onchange = e => {
        const lang = e.target.value;
        htmlEditor.updateOptions({ readOnly: lang !== 'html' });
        cssEditor.updateOptions({ readOnly: lang !== 'html' });
        jsEditor.updateOptions({ readOnly: lang === 'html' ? false : (lang === 'javascript') });
      };

      window.runAll = () => {
        const html = htmlEditor.getValue();
        const css = `<style>${cssEditor.getValue()}</style>`;const js = `<script>${jsEditor.getValue()}<\/script>`;
    document.getElementById('frame').srcdoc = html + css + js;
    saveRecentProject();
  };

  function saveRecentProject() {
    const projects = JSON.parse(localStorage.getItem('recentProjects') || '[]');
    const newProject = {
      html: htmlEditor.getValue(),
      css: cssEditor.getValue(),
      js: jsEditor.getValue(),
      date: new Date().toISOString()
    };
    projects.unshift(newProject);
    if (projects.length > 5) projects.pop();
    localStorage.setItem('recentProjects', JSON.stringify(projects));
  }

  window.saveCode = () => {
    const data = {
      html: htmlEditor.getValue(),
      css: cssEditor.getValue(),
      js: jsEditor.getValue()
    };
    localStorage.setItem('myCodePen', JSON.stringify(data));
    alert('ذخیره شد!');
  };

  const loaded = localStorage.getItem('myCodePen');
  if (loaded) {
    const d = JSON.parse(loaded);
    htmlEditor.setValue(d.html);
    cssEditor.setValue(d.css);
    jsEditor.setValue(d.js);
  }
});

function loadFile(e) {
  const file = e.target.files[0];
  const ext = file.name.split('.').pop();
  const reader = new FileReader();
  reader.onload = () => {
    const txt = reader.result;
    if (ext === 'html') htmlEditor.setValue(txt);
    if (ext === 'css') cssEditor.setValue(txt);
    if (ext === 'js') jsEditor.setValue(txt);
  };
  reader.readAsText(file);
}

function downloadVideo() {
  alert("دانلود ویدیو از ۱۰ تا ۹۰ ثانیه فعال خواهد شد (شبیه‌سازی)");
  // عملکرد ساخت ویدیو باید سمت سرور یا با ابزار مخصوص انجام شود
}

  </script>
</body>
</html>
