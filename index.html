<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ø´Ø¨ÛŒÙ‡ CodePen</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/editor/editor.main.min.css" rel="stylesheet" />
  <style>
    body, html { margin:0; padding:0; height:100%; font-family:sans-serif; direction:rtl; }
    .topbar { height:50px; background:#252526; display:flex; align-items:center; justify-content:space-between; padding:0 15px; color:#eee; }
    .topbar select, .topbar button, .topbar input { margin:0 5px; padding:6px; border-radius:6px; border:none; background:#3A3D41; color:white; }
    .main { display:flex; height:calc(100% - 50px); }
    .panel { flex:1; display:flex; flex-direction:column; }
    #editorHtml, #editorCss, #editorJs { height:33.33%; border-bottom:1px solid #444; }
    .preview { flex:1; background:#fff; }
    iframe { width:100%; height:100%; border:none; }
  </style>
</head>
<body>

  <div class="topbar">
    <div>
      <button onclick="runAll()">â–¶ Ø§Ø¬Ø±Ø§</button>
      <button onclick="saveCode()">ðŸ’¾ Ø°Ø®ÛŒØ±Ù‡</button>
      <input type="file" onchange="loadFile(event)">
    </div>
    <div>
      <select id="themeSel">
        <option value="vs-dark">ØªØ§Ø±ÛŒÚ©</option>
        <option value="vs">Ø±ÙˆØ´Ù†</option>
      </select>
      <select id="langMode">
        <option value="html">HTML/CSS/JS</option>
        <option value="javascript">JavaScript</option>
      </select>
    </div>
  </div>

  <div class="main">
    <div class="panel">
      <div id="editorHtml"></div>
      <div id="editorCss"></div>
      <div id="editorJs"></div>
    </div>
    <div class="panel preview">
      <iframe id="frame"></iframe>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs/loader.js"></script>
  <script>
    require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.34.1/min/vs' }});
    require(['vs/editor/editor.main'], () => {
      window.htmlEditor = monaco.editor.create(document.getElementById('editorHtml'), {
        language: 'html', theme: 'vs-dark', automaticLayout:true, minimap:{enabled:false}
      });
      window.cssEditor = monaco.editor.create(document.getElementById('editorCss'), {
        language: 'css', theme: 'vs-dark', automaticLayout:true, minimap:{enabled:false}
      });
      window.jsEditor = monaco.editor.create(document.getElementById('editorJs'), {
        language: 'javascript', theme: 'vs-dark', automaticLayout:true, minimap:{enabled:false}
      });

      document.getElementById('themeSel').onchange = e => {
        monaco.editor.setTheme(e.target.value);
      };
      document.getElementById('langMode').onchange = e => {
        const lang = e.target.value;
        htmlEditor.updateOptions({ readOnly: lang !== 'html' });
        cssEditor.updateOptions({ readOnly: lang !== 'html' });
        jsEditor.updateOptions({ readOnly: lang === 'html' ? false : (lang === 'javascript') });
      };

      window.runAll = () => {
        const html = htmlEditor.getValue();
        const css = `<style>${cssEditor.getValue()}</style>`;
        const js = `<script>${jsEditor.getValue()}<\/script>`;
        document.getElementById('frame').srcdoc = html + css + js;
      };

      window.saveCode = () => {
        const data = {
          html: htmlEditor.getValue(),
          css: cssEditor.getValue(),
          js: jsEditor.getValue()
        };
        localStorage.setItem('myCodePen', JSON.stringify(data));
        alert('Ø°Ø®ÛŒØ±Ù‡â€ŒØ´Ø¯!');
      };

      const loaded = localStorage.getItem('myCodePen');
      if (loaded) {
        const d = JSON.parse(loaded);
        htmlEditor.setValue(d.html);
        cssEditor.setValue(d.css);
        jsEditor.setValue(d.js);
      }
    });

    function loadFile(e) {
      const file = e.target.files[0];
      const ext = file.name.split('.').pop();
      const reader = new FileReader();
      reader.onload = () => {
        const txt = reader.result;
        if (ext === 'html') htmlEditor.setValue(txt);
        if (ext === 'css') cssEditor.setValue(txt);
        if (ext === 'js') jsEditor.setValue(txt);
      };
      reader.readAsText(file);
    }
  </script>
</body>
</html>
